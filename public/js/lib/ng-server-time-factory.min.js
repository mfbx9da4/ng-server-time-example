angular.module("ng-server-time",[]).factory("ServerTime",["socket","$interval",function(e,t){var n={last_five_offsets:[],verbose:!1,ping:function(){e.emit("server time",Date.now())},getOffset:function(){return n.offset},now:function(){return Date.now()+n.offset},"new":function(){return new Date(n.now())},onServerTime:function(e){var t=e.server_transmission_time-Date.now(),s=e.server_transmission_time-e.sender_transmission_time,r=(t+s)/2;for(n.last_five_offsets.push(r);n.last_five_offsets.length>5;)n.last_five_offsets.shift();var f=n.last_five_offsets.slice();f.sort(function(e,t){return t-e}),f.length>3&&(f=f.slice(1,4));for(var o=0,i=0;i<f.length;i++)o+=f[i];var a=Math.floor(o/f.length);n.offset=a,n.verbose&&console.log(f,"offset",n.offset)},init:function(){e.on("server time",n.onServerTime),n.ping(),n.pingInterval=t(n.ping,500)}};return n.init(),{now:n.now,"new":n["new"],ping:n.ping,getOffset:n.getOffset}}]);